Задания по работе с рядами данных
=================================

**Цели работы**

Блок 1: освоить навыки работы временными рядами макроэкономических данных из FRED и rosstat-kep-data в R/pandas
 - идеология и примеры работы с открытыми автоматизированными базами данных 
 - типы данных и операции для работы с временными рядами в R (ts, zoo) и python pandas (Series):
   - создание переменных 
   - манипулирование данными
   - построение графиков
   - экспорт/импорт в CSV/Excel   
 - автоматизированное получение рядов данных экономической статистики из баз данных FRED и rosstat-kep-data

Блок 2:
- ознакомление с составом данных по российской экономической статистике и ее возможным применением
- снятие сезонности в рядах макроэкономических данных
- снятие трендов и корреляция между динамикой макроэкономических переменных для США и России (эмпирические основы анализа бизнес-циклов)
 
Блок 3:
- построение простых эконометрических моделей отдельных макроэкономических переменных в R/statmodels/Eviews - на данных rosstat-kep-data (блок 3) 


Блок 1. Доступ к рядам данных 
-----------------------------

###1.1 Описание kep-rosstat-data (ЕП)
- мотивация создания базы данных открытой статистики с API  (=reproducible research) + прототипы (FRED, Quandl /  где еще выложена российская статистика в собранном виде)
- похожие источники источники данных:
  - FRED
  - Quandl
  - EIA
  - Мирбанк
  - yahoo.com (котировки акций)
  - другие API  
- как пользователю освоиться с базой данных kep-rosstat-data
  - исходная публикация КЭП, ее дополняют СЭП, другие сборники Росстата
  - КЭП: можно посмотреть csv
  - КЭП: оглавление + список переменных + приницпы обозначения переменных 
- какие еще основные источники российской макроэкономической статистики? 

```Что надо сделать:```
Помощь по разделу не требуется.

###1.2. Введение по работе с R/pandas:

<https://github.com/epogrebnyak/cmf-macro/issues/1>

Общая задача:
```
 - типы данных и операции для работы с временными рядами в R (ts, zoo, xts) и python pandas (Series):
   - создание переменных 
   - манипулирование данными
   - построение графиков
   - экспорт/импорт в CSV/Excel
```

####Что надо сделать:

- [ ] доработать ts_intro.py: <https://github.com/epogrebnyak/cmf-macro/blob/master/time_series_intro/python/ts_intro.py#L79>

- [ ] решить в какой тип в R будут импортироваться данные из rosstat-kep-data (ts, zoo, что-то еще) - <https://github.com/epogrebnyak/rosstat-kep-data/issues/122>

- [ ] сделать аналог [ts_intro][ts_intro_r_url] и [dates_intro][dates_intro_r_url] на R, при этом при этом объяснить кратко разницу между типами ts, zoo и/или другими необходимыми типами

[ts_intro_r_url]: https://github.com/epogrebnyak/cmf-macro/blob/master/time_series_intro/r/ts_intro.r
[dates_intro_r_url]: https://github.com/epogrebnyak/cmf-macro/blob/master/time_series_intro/r/dates_intro.r

- [ ]  если успеваем - дать ```построение графиков``` и ```экспорт/импорт в CSV/Excel``` в R и pandas

**Кто делает:** ...  



###1.3 Упражнения по работе с данными FRED и rosstat-kep-data

<https://github.com/epogrebnyak/cmf-macro/issues/2>

Основная идея - получить данные <https://github.com/epogrebnyak/rosstat-kep-data/> в виде датафреймов. Это необходимо для 
выполнения последующих заданий. Дополнительно идет получение данных FRED, для наработки опыта работы с API.

```
Excecise:

      1. obtain dfa, dfq, dfm dataframes from https://github.com/epogrebnyak/rosstat-kep-data/ 
      
      2. try plotting some variables, e.g. reproduce graphs at https://github.com/epogrebnyak/rosstat-kep-data/blob/master/README.md#Основные-показатели
         also at qtr and annual frequencies
         
         Pandas plotting code used may be found at: 
         https://github.com/epogrebnyak/rosstat-kep-data/blob/master/kep/extract/plots.py#L130-L139
		 
		 Note: plot formats not important here, main task is to generate some plots. 
         
      3. (Optional.) Get and plot similar indicators (as in README.md) for US economy from FRED (https://research.stlouisfed.org/docs/api/fred/)
```


####Что надо сделать
- сделать аналог файла [interface.py](https://github.com/epogrebnyak/rosstat-kep-data/blob/master/interface.py) в [interface.r](https://github.com/epogrebnyak/rosstat-kep-data/blob/master/interface.r)
- нарисовать в R и pandas переменные из [этого списка](https://github.com/epogrebnyak/rosstat-kep-data/blob/master/README.md#Основные-показатели)
- получить аналогичные переменные для США из (https://research.stlouisfed.org/docs/api/fred/) в R и pandas
- (дополнительное) задание студентам: в чем вы видите разницу между американскими и российскими данными 

**Кто делает:** ...  



Блок 2. Сквозные задания
------------------------

###2.1 Ознакомление с составом данных по российской экономической статистике в rosstat-kep-data

###2.1.1 Полнота данных

  -  Каких рядов данных, на ваш взгляд, не хватает в базе данных rosstat-kep-data, и для чего они могли бы быть использованы? 

```Что надо сделать```:
Основное/обязательное:
- нужно будет собрать со студентов такое задание и проверить такое задание (прислали-не прислали, что интересного написали)

Дополнительно:
- нужен список по основным источникам данных по ведомствам и сайтам (Росстат, ЦБ, ФТС, Казначейство, кто-то еще?) + ссылки на формы 
  статнаблюдения (мет. указания Россстата), идеале это "статистическая модель" - откуда берется первичная информация, когда она 
  эта статмодель полная. Для простоты нужен набор ссылок на статпубликации и пояснения как они друг друга дополняют. 
  По сути, в наборе данных не хватает платежного баланса и банковской статистики + счетов производства и использования ВВП.  
  
- кто-то предлагал отпарсить данные ЦБ - можно добавить примеры как это делается, как применяется
  
**Кто делает:** ...  


###2.1.2  Целостность данных

  -  Какие проверки для правильности данных rosstat-kep-data в базе Вы могли бы предложить? 
  
  Что можно проверить:  
   - темпы роста номинальных показателей 
   - суммы отдельных показателей должны соответствовать, там где есть суммы
   - расчет реальных показтелей
   - что-то еще?

####Что надо сделать
 - код c примерами проверок в R и/или pandas
 - проверить это задание у студентов 
  
**Кто делает:** ...  



###2.1.3 Выборка данных

  - Найдите публикации с упоминанием экономической статистики, которые можно воспроизвести из данных rosstat-kep-data и FRED

Пример:
```  
# ссылка на текст новости или материал 
# копия текста
# расчет показателя

# http://www.veb.ru/analytics/iVEB/
# Мы оцениваем, что и в III, и в IV кварталах прошлого года темп роста промышленности составлял 0,3%, после падения на 2,7% в первом квартале и 2,4% во втором.
# код, который выводит эти показатели 
print()
```

####Что надо сделать
 - 3-4 примера таких показателей - особенно интересны случаи, когда они рассчитываются, а не просто упоминаются значения
 - собрать и проверить это задание у студентов 
  
**Кто делает:** ...  



###2.2 Снятие сезонности

<https://github.com/epogrebnyak/cmf-macro/issues/4>

####Что надо сделать

- ```TODO Seas1``` - пример кода с анализом сезонности в выбранных показателей rosstat-kep-data 
- ```TODO Seas2``` - лекция по снятию сезонности
- ```TODO Seas3``` - код для снятия сезонности в R / python для дальнейшего использования в заданиях
- ```TODO Seas4``` - ЕП - кейс по сезонности бюджетных расходов

####План

1. Описательный анализ сезонности в rosstat-kep-data 
  -  На каких графиках каких показателей сезонность выражена больше всего, с чем это может быть связано? 
     - графики: <https://github.com/epogrebnyak/rosstat-kep-data/blob/master/output/images.md>
	 - названия переменных: <https://github.com/epogrebnyak/rosstat-kep-data/blob/master/output/varnames.md>
  -  Для каких показателей снятие сезонности нежелательно? (пример - биржевые котировки)  
  -  Есть ли такая же сезонность в аналогичных показателях в США?
  -  ```TODO Seas1``` Напишите код, который иллюстрирует наличие и масштаб сезонности в нескольких выбранных показателях по России (rosstat-kep-data) и США (FRED)

  Дополнительно: кейс по бюджету сезонности расходов бюджета в РФ и США (из лекций прошлого года) ```TODO Seas4```
  
2. Краткое введение в снятие сезонности ```TODO Seas2```

  - какая задача решается (тренд + сезоннность + случайный остаток), неоднозначность решения
  - простейшие способы снятия сезонности: мултипликативные / аддитивные коэффициенты к скользящему среднему, ограничения подхода
  - другие подходы
  - дополнителные задачи в снятии сезонности (выбросы, смена тренда)
  - X11, Traumo/SEATS (Demetra)

  Литература и ссылки:
   - [ESS guidelines on seasonal adjustment](http://ec.europa.eu/eurostat/documents/3859598/6830795/KS-GQ-15-001-EN-N.pdf/d8f1e5f5-251b-4a69-93e3-079031b74bd3) 
   - [Seasonal Adjustment Methodology at BLS](http://www.bls.gov/cpi/cpisahoma.htm)
   - ... добавить
 
3. Код для снятия сезонности в показаателях в R/python ```TODO Seas3```
  - в каких пакетах реализовано снятие сезнности в R/python, примеры
  - сейчас доступно: https://github.com/epogrebnyak/additional/tree/master/seasonality
  - новый код для снятия сезнности в pandas / R


###2.3 Снятие трендов и корреляция остатков

####Что надо сделать

 - ЕП:дописать задание

####План

  - примеры по США - анализ совместной динамики макроэкономических переменных 
  - процедура снятия тренда
  - корреляционная матрица остатков после снятия тренда


Блок 3.Задания по разделам
--------------------------

#### Что надо сделать по разделам
В выбранной вами теме из списка ниже неободимо дать код простых регрессий и комментарий к нему, который позволит
проверить задание, выполняемое студентами. 

Разделы:
 - 1 ВВП и производство (можно выполнять)
 - 2 Инфляция (ЕП: дорабатывать)
 - 3 Бюджет (ЕП: дорабатывать)
 - 4 Население  (ЕП: дорабатывать)
 - 5 Инвестиции  (можно выполнять)
 - 6 Внешняя торговля (ЕП: дорабатывать)
 - 7 Валютный курс (можно выполнять)

Обязательно:
1. ```TODO_<Topic>_Code``` **код построенных регерессий**
  - предпочтительнее делать в R и/или pandas/statmodels 
  - код или должен начинаться c импорта данных из rosstat-kep-data. описание опций импорта:
    - <https://github.com/epogrebnyak/rosstat-kep-data/blob/master/interface.py>
    - <https://github.com/epogrebnyak/rosstat-kep-data/blob/master/interface.r>	
    - полистать список доступных переменных по разделам: <https://github.com/epogrebnyak/rosstat-kep-data/blob/master/data/2015/ind12/toc.txt>
  - как исключение, можно делать не в R и/или pandas (EViews, Excel, Matlab и т.д.), но в итоге кто-то другой 
    затем должен будет это перевести в R/pandas/statmodels

2. ```TODO_<Topic>_Comment``` **комментарии к регрессиями**
  - самое важное, что надо знать про связь между переменными и про качество регрессии
  - ... особено интересны результаты не соответсвующие "ожидаемым"
  - можно писать пунктами/буллетами, чтобы не было много текста
  - буллеты должны помочь проверить задание студентов (текст задания см ниже)
  
Опционально:
1. ссылки на литературу и материалы, в которых могут быть:
  - графики используемых показателей для других стран/временных периодов;
  - теоретические модели; 
  - аналогичные несложные регрессии;
  - другая полезная информация для выполнения этого задания.
2. внтури блоков можно добавлять новые вопросы исследований и ожидаемые/полученные результаты.
3. редакция текста задания студентам (ниже)

Код, комментарии, ссылки могут быть в одном файле или в разных.   

#### Задание для студентов

В используемой базе данных rosstat-kep-data есть ограниченный набор показателей, но даже с его помощью можно показать отдельные макроэкономиечкие 
закономерности. Вам требуется ответить на поставленные вопросы по разделам, для каждого рассматриваемого показателя построить простую 
эконометрическую модель, сделать выводы о качестве модели, ее соответствии теории и Вашим ожиданиям + предложить какие альтернативные 
модели могут быть построены (с другой методологией, большим набором данных) и в чем будут их преимущества, что они позволят объяснять.

Шаги по решению задач по разделам:
- получить исходные данные и изучить их
- сформулировать вопросы и гипотезы для исследования
- преобразовать данные и составить модель рассматриваемого показателя
- показать результаты
- сделать выводы по вопросам и гипотезам 
- предложения по дальшейшим возможным шагам анализа

При разборе зависимости необходимо указать:
1. зависимость между какими переменными мы пытаемся объяснить регрессией 
2. почему мы предполагаем, что зависимость существует, например:
 - следует из определения переменных (комментарий: но если да, то зачем регрессия)
 - следует из экономической логики, если да - уточнить в чем состиот эта логика 
 - есть теоретические модели, если да - какие
 - зависимость прослеживается на других рынках
 - какие-то другие причины
3. какие конкретные гипотезы исследования выдвигаются (особенно важно там, где гипотез много)
4. программный код получения данных и код регрессии  
5. основные выводы по гипотезам переменных и закономерности в целом 
6. предложения по развитию модели
 

###1 ВВП и производство
  -  Динамика производства: насколько отличается динамика производства промышленности в целом, по отраслям и по отдельным           продуктам 
  -  Насколько динамика ВВП объясняется динамикой промышленного производства?

 Ожидаемые результаты: 
  - все показатели производства сильно коррелируют
  - ВВП объясняется динамикой производства
  - раз много похожих объясняющих показателей - можно предложить выбирать самые информативные (например, метод главных компонент)

###2 Инфляция
  -  воспроизвести рисунки из публикации ЦБ по инфляции
  -  инфляция vs курс, денежная масса
  -  какова связь между ИПЦ и ИЦП (CPI/PPI)?
  -  регрессия монетарная/немонетарная - ссылка на статью

###3 Бюджет
  -  зависят ли доходы бюджета от цены на нефть и в какой степени?
  -  что еще определяет доходы бюджета?
  -  по имеющимся данным оцените размер государственного долга РФ (накопленный профицит/дефицит)
 
###4 Население
  - что определяет расходы и финансовое поведение потребителей?

###5 Инвестиции
  -  от чего зависит объем инвестиций в основной капитал? объем вводов жилья?
  -  какие опережающие показатели инвестицй можно исопльзовать? (стройматериалы, )
  
 Объясняющие переменные: 
   - прибыль 
   - объем производства с лагом вперед (фирмы могут ожидать расширение спроса)
   - доступность кредита (через объем кредита)
   - инфляция, какой-то из показателей инфляции (ИПЦ, ИЦП) - и почему (низкая инфляций - более устойчивые условия, высокая инфляция по ИЦП - рост рынков)
   - удорожание (стоимость) инвестиций - цены на инвестиционные товары

 Ожидаемые результаты: 
   - как правило инвестиции очень волатильны и хорошо их мало что может прогнозировать
   - на инвестиции влияют общеэкономичекие 
   - сложно проверить теоретичекие модели (eg Tobin's q)
   - различные опережающие индексы инвестицонной активности достаточно хорошо
   - внутри года нужно показатель инвестиций сглаживать, неcглаженный прогнозирвоать внутри года не имеет смысла  

###6 Внешняя торговля
  -  от чего зависит импорт?
     - простая регрессия импорт - реальный рост доходов, курс
  -  чувствителен ли российский экспорт к валютному курсу

###7 Валютный курс

  На данном наборе данных можно исследовать связь между курсов и инфляцией, может быть что-то еще, но немного. 
 
Замечание:
 - по результатам заданий можно вернуться к п. *"Полнота данных - 1"*, переработать и расширить его.
 
