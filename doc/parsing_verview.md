Парсер данных 
=============

Общая задача
------------
На входе: 
 - файл Ворда с таблицами данных и заголовками
 - инструкции для парсинга   

На выходе: 
 - три локальных csv файла (месячный, квартальный и годовой) 
 - файл с описаниями переменных (имя, описание, размерность)

 
Ход парсинга
------------
**(1) Конвертация файла Word** 
- Word файл переписывается в csv (эта часть хорошо работает)
-----
**(2) Чтение исходных данных** 
- все строки сырого CSV считываются в список строк Rows().rows
- из Yaml файлов считываются инструкции для парсинга
-----
- инструкции парсинга привязаны к сегментам файла
- сегмент действует с какой-то по какую-то строку csv файла 
- в инструкции парсинга содержатся два словаря:
  - привязка названий таблиц из файла к названиям переменных (словарь 1)
  - привязка названий размерности к обозначениям размерности (словарь 2)

Пример инструкции для парсинга: 
```
{       'scope': {'end_line': None, 'start_line': None},   # инструкция по умолчанияю
                                                           # действует во всем файле   
  'reader_func': None,
        'units': {'в процентах': 'percent', 
                  'в % к предыдущему периоду': 'chg',
                  'в % к началу года': 'ytd'},
        
'table_headers': { 'Выпуск стали' : ['PROD_STEEL', 'ton'],
       'Грузооборот транспорта' : ['CARGO', 't_km'],        
       'Объем ВВП' : ['GDP', 'bln_rub']}     
    }
```

-----
Интересны строки CSV файла следующих типов:
- заголовки разделов ("1.1.")
- заголовки таблиц с названием показателя и его размерностью
- подзаголовки таблиц с размерностью
- строки с данными таблиц

Пример:
```Выпуск стали, т <<<- заголовок с размерностью
2016 \<...данные...\>  
2017 \<...данные...\>
в % к предыдущему периоду <<<- размерность
2016 \<...данные...\>
2017 \<...данные...\>

Грузооборот транспорта, тонн-км <<<- заголовок с размерностью
2016 \<...данные...\>  
2017 \<...данные...\>
в % к началу года <<<- размерность
2016 \<...данные...\>
2017 \<...данные...\>
```

----- 
**(3) Разметка строк csv файла** 

Что мы делаем с файлом:
- мы привязали инструкции по парсингу к сегментам файла
- далее идем от начала файла к концу по строкам, наша цель - 
  привязать к каждой строке с данными название переменной и ее размерность

Для этого:
  1. когда мы встречаем строку заголовка, мы присваиваем этой 
     строке название и размерность переменной из словаря 1
  2. если дальше идет строка с данными, то ей присваивается 
     название и размерность, что и предыдущей строке
  3. когда мы встречаем строку размерности, то меняем размерность,
     а название размерности остается то же 
  4. далее повторяется п. 2

В результате процедуры мы разметим строки названиями переменных и размерностями. Данные готовы к импорту
  
Пример:
```
PROD_STEEL    ton    Выпуск стали, т          
PROD_STEEL    ton    2016 \<...данные...\>  
PROD_STEEL    ton    2017 \<...данные...\>
PROD_STEEL    chg    в % к предыдущему периоду <<<- размерность
PROD_STEEL    chg    2016 \<...данные...\>
PROD_STEEL    chg    2017 \<...данные...\>

CARGO         t_km   Грузооборот транспорта, тонн-км <<<- заголовок с размерностью
CARGO         t_km   2016 \<...данные...\>  
CARGO         t_km   2017 \<...данные...\>
CARGO         ytd    в % к началу года <<<- размерность
CARGO         ytd    2016 \<...данные...\>
CARGO         ytd    2017 \<...данные...\>
```  
-----
(4) Импортируем данные 

- Из каждой строки с данными мы можем выдаем серию точек ("название переменной" - "дата" - "частота" - "значение")
- Эту работу выполняет функция парсинга, которая разберет значения строки на годовое, квартальные и месяные для этого года.
- Эта функция отличается по сегментам файла, она указана в инструкции для парсинга для каждого сегмента

-----

Пример: предположим в "таблице Грузооборот транспорта, тонн-км" указаны годовое и кваратльные значения. 
Возьмем одну строку csv файла:
```
CARGO         t_km   2016  700 100 200 150 250 
```

Тогда из строки  будет сгенерировано 5 значений: 
```
CARGO_t_km A 2016   700
CARGO_t_km Q 2016 1 100
CARGO_t_km Q 2016 2 200
CARGO_t_km Q 2016 3 150
CARGO_t_km Q 2016 4 250
```
Эти значения могут быть сохранены в базе данных или использованы для создания датафреймов pandas,
откуда они сохраняются в csv.

Что можно проверить 
--------------------
(...)

Риски
-----
(...)
